/*!CK:3279279176!*//*1450227886,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["tKJju"]); }

__d('P2PSendMoneyDialog.react',['Arbiter','CreditCardFormParam','CurrentEnvironment','Image.react','ImageBlock.react','Link.react','MessengerContextualDialog.react','P2PAPI','P2PAddCreditCardDialog.react','P2PButton.react','P2PCreditCardStore','P2PChooseCreditCardForm.react','P2PConfirmAmountDialog.react','P2PCreditCard','P2PDialog.react','P2PDialogTitle.react','P2PEditCreditCardDialog.react','P2PGKValues','P2PLinkConstants','P2PLoadingMask.react','P2PLogger','P2PMemoField.react','P2PMemoText.react','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PSendMoneyAmountInput.react','P2PSendMoneyDialogActionHeader.react','P2PText.react','P2PVerifyCreditCardDialog.react','React','ReactLayeredComponentMixin','XUIContextualDialog.react','XUISpinner.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa){'use strict';if(c.__markCompiled)c.__markCompiled();var qa=ka.PropTypes,ra=j.messengerdotcom,sa=y.P2PRequestMoneyEnabled,ta=pa._("Change"),ua=pa._("Add Debit Card"),va=100,wa=ka.createClass({displayName:'P2PSendMoneyDialog',mixins:[la],propTypes:{amount:qa.string,currency:qa.string.isRequired,currencySymbol:qa.string.isRequired,groupThreadFBID:qa.string,flyoutAlignment:qa.string,memoText:qa.string,onError:qa.func.isRequired,onPaymentRequestError:qa.func.isRequired,onPaymentRequestSuccess:qa.func.isRequired,onSendSuccess:qa.func.isRequired,onToggle:qa.func.isRequired,platformData:qa.object,receiver:qa.object,referrer:qa.string,paymentRequestID:qa.string,useModal:qa.bool},getDefaultProps:function(){return {amount:'',receiver:{},useModal:false};},getInitialState:function(){var xa=r.getAll();return {asyncRequestState:r.getAsyncRequestState(),addCreditCardDialogShown:false,amount:this.props.amount,creditCards:xa,confirmAmountDialogShown:false,isAmountValid:false,isCreditCardsFetchComplete:r.isCreditCardsFetchComplete(),isPaying:true,isRequesting:false,loading:false,memoText:this.props.memoText,selectedCard:xa[0],showChooseCreditCardForm:false,verifyCreditCardDialogShown:false};},creditCardStoreSub:null,_isAmountVerified:false,passwordCancelSubscribeToken:null,getEventFlow:function(){return (this.props.paymentRequestID||this.isRequesting()?fa.UI_FLOW_P2P_REQUEST:fa.UI_FLOW_P2P_SEND);},log:function(xa,ya){ba.log(xa,babelHelpers._extends({www_event_flow:this.getEventFlow(),object_id:this.props.receiver&&this.props.receiver.userID,memo_text:this.state.memoText,request_id:this.props.paymentRequestID},this.getPlatformLoggingData(),ya,this.getReferrer()));},componentWillUnmount:function(){if(this.passwordCancelSubscribeToken!==null){h.unsubscribe(this.passwordCancelSubscribeToken);this.passwordCancelSubscribeToken=null;}if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}},componentWillMount:function(){this.creditCardStoreSub=r.addListener('change',this.onCreditCardStoreChange);this.log(ea.UI_ACTN_INITIATE_SEND);},getPlatformLoggingData:function(){var xa=this.props.platformData&&this.props.platformData.loggingData;if(xa)return {platform_logging_data:xa};return null;},getReferrer:function(){var xa=this.props.referrer;if(xa)return {www_event_referrer:xa};return null;},onAmountInputChange:function(xa,ya){this.setState({amount:xa,isAmountValid:ya});},onCreditCardStoreChange:function(){var xa=r.getAll(),ya;if(this.state.selectedCard)ya=xa.filter((function(za){return (za.getCredentialId()===this.state.selectedCard.getCredentialId());}).bind(this))[0];if(!ya)ya=xa[0];this.setState({asyncRequestState:r.getAsyncRequestState(),creditCards:xa,isCreditCardsFetchComplete:r.isCreditCardsFetchComplete(),selectedCard:ya});},shouldShowConfirmAmountDialog:function(){var xa=parseFloat(this.state.amount);return (!this._isAmountVerified&&xa>=va);},shouldShowVerifyCreditCardDialog:function(){return !this.state.selectedCard.getIsVerified();},shouldShowEditCreditCardDialog:function(){return this.state.selectedCard.isExpired();},handleSendClick:function(xa){if(this.isSendButtonDisabled())return false;this.log(ea.UI_ACTN_SEND_CLICKED,{raw_amount:this.state.amount,currency:this.props.currency});this._isAmountVerified=false;this.initiatePayment();},handleRequestClick:function(xa){if(this.isRequestButtonDisabled())return false;this.log(ea.UI_ACTN_REQUEST_CLICKED,{raw_amount:this.state.amount,currency:this.props.currency});this.createPaymentRequest();},initiatePayment:function(){if(this.shouldShowConfirmAmountDialog()){this.hideAllDialogs();this.setState({confirmAmountDialogShown:true});this.log(ea.UI_ACTN_CONFIRM_AMOUNT,{raw_amount:this.state.amount,currency:this.props.currency});return;}else if(this.shouldShowEditCreditCardDialog()){this.hideAllDialogs();this.setState({editCreditCardDialogShown:true});this.log(ea.UI_ACTN_EDIT_CARD,{raw_amount:this.state.amount,currency:this.props.currency});return;}else if(this.shouldShowVerifyCreditCardDialog()){this.hideAllDialogs();this.setState({verifyCreditCardDialogShown:true});this.log(ea.UI_ACTN_VERIFY_CSC,{raw_amount:this.state.amount,currency:this.props.currency});return;}this.createTransaction();},isPayingForRequest:function(){return !!this.props.paymentRequestID;},isPaying:function(){return this.state.isPaying===true;},isRequesting:function(){return this.state.isRequesting===true;},shouldShowLoading:function(){return (!this.state.addCreditCardDialogShown&&!this.state.confirmAmountDialogShown&&!this.state.verifyCreditCardDialogShown&&!this.state.editCreditCardDialogShown);},createTransaction:function(){var xa={};this.setState({loading:this.shouldShowLoading()});xa[i.CREDENTIAL_ID]=this.state.selectedCard.getCredentialId();xa.amount=this.state.amount;xa.receiverId=this.props.receiver&&this.props.receiver.userID;xa.memoText=this.state.memoText;xa.paymentRequestID=this.props.paymentRequestID;if(this.props.groupThreadFBID)xa.group_thread_fbid=this.props.groupThreadFBID;if(this.props.platformData)xa.platform_context_id=this.props.platformData.platformContextID;this.passwordCancelSubscribeToken=h.subscribeOnce('PasswordReauthDialogCancelClick',this.handlePasswordReauthDialogCancelClick);o.createTransaction({formData:xa,error:this.setCreateTransferError,success:this.setCreateTransferSuccess});this.log(ea.UI_ACTN_CONFIRM_SEND,{raw_amount:this.state.amount,currency:this.props.currency});},createPaymentRequest:function(){this.setState({loading:this.shouldShowLoading()});o.createPaymentRequest({formData:{amount:this.state.amount,memoText:this.state.memoText,group_thread_fbid:this.props.groupThreadFBID,requesteeID:this.props.receiver&&this.props.receiver.userID},error:this.setCreatePaymentRequestError,success:this.setCreatePaymentRequestSuccess});this.log(ea.UI_ACTN_CONFIRM_REQUEST,{raw_amount:this.state.amount,currency:this.props.currency});},hideAllDialogs:function(){this.setState({addCreditCardDialogShown:false,confirmAmountDialogShown:false,verifyCreditCardDialogShown:false,editCreditCardDialogShown:false});},isDialogShowing:function(){return !!(this.state.addCreditCardDialogShown||this.state.confirmAmountDialogShown||this.state.verifyCreditCardDialogShown||this.state.editCreditCardDialogShown);},setCreateTransferError:function(xa){if(this.isMounted()){this.hideAllDialogs();this.setState({loading:false});}this.props.onError(xa);this.log(ea.UI_ACTN_SEND_FAIL);},setCreateTransferSuccess:function(xa){if(this.isMounted()){this.setState({loading:false});this.hideAllDialogs();}this.props.onSendSuccess(xa);this.log(ea.UI_ACTN_SEND_SUCCESS);},setCreatePaymentRequestError:function(xa){if(this.isMounted()){this.hideAllDialogs();this.setState({loading:false});}this.props.onPaymentRequestError(xa.error);this.log(ea.UI_ACTN_REQUEST_FAIL);},setCreatePaymentRequestSuccess:function(xa){if(this.isMounted()){this.setState({loading:false});this.hideAllDialogs();}this.props.onPaymentRequestSuccess();this.log(ea.UI_ACTN_REQUEST_SUCCESS,{request_id:xa.id});},handlePasswordReauthDialogCancelClick:function(){this.passwordCancelSubscribeToken=null;this.setState({loading:false});this.hideAllDialogs();},onAddCreditCardCancel:function(){this.setState({addCreditCardDialogShown:false});},onAddCreditCardSuccess:function(xa){var ya=this.state.creditCards.filter(function(za){var ab=za.getCredentialId();return (xa[i.CREDENTIAL_ID]===ab);})[0];this.setState({selectedCard:ya});if(this.state.isAmountValid){this.initiatePayment();}else{this.setState({addCreditCardDialogShown:false});this.focusAmountInput();}},onEditCreditCardSuccess:function(){this.initiatePayment();},onEditCreditCardCancel:function(){this.setState({editCreditCardDialogShown:false});},focusAmountInput:function(){if(this.refs.send_money_amount_input)this.refs.send_money_amount_input.focus();},_handleToggle:function(xa){this.props.onToggle(xa);if(!this.state.loading)this.log(ea.UI_ACTN_SEND_MONEY_CANCELLED);},_handleBlur:function(){this._handleToggle(false);},handleAddCreditCardClick:function(){this.setState({addCreditCardDialogShown:true,showChooseCreditCardForm:false});this.log(ea.UI_ACTN_CHANGE_CARD);},handleBackClick:function(){this.setState({showChooseCreditCardForm:false},(function(){this.focusAmountInput();}).bind(this));},handleChooseCardNextClick:function(){var xa=this.refs.choose_credit_card_form.getSelectedCard();this.setState({selectedCard:xa,showChooseCreditCardForm:false},(function(){this.focusAmountInput();}).bind(this));},handleAddCardNextClick:function(){this.setState({addCreditCardDialogShown:true});},handleChangeSelectedCardClick:function(){var xa={};if(this.state.creditCards.length===1){xa.addCreditCardDialogShown=true;this.log(ea.UI_ACTN_CHANGE_CARD);}else{xa.showChooseCreditCardForm=true;this.log(ea.UI_ACTN_INITIATE_CHOOSE_CARD);}this.setState(xa);},onConfirmAmountCancel:function(){this.setState({confirmAmountDialogShown:false});},onConfirmAmountSuccess:function(){this._isAmountVerified=true;this.initiatePayment();},onVerifyCreditCardSuccess:function(){this.initiatePayment();},onVerifyCreditCardCancel:function(){this.setState({verifyCreditCardDialogShown:false});},handleMemoChange:function(xa){this.setState({memoText:xa});},isSendButtonDisabled:function(){return (!this.state.isAmountValid||!this.state.creditCards.length||this.state.loading);},isRequestButtonDisabled:function(){return !this.state.isAmountValid||this.state.loading;},isAddCardNextButtonDisabled:function(){return !this.state.isAmountValid;},renderAddDebitCardLink:function(){return (ka.createElement(ia,{className:"_42h3",type:'secondary',ref:'send_money_dialog_add_card_text'},ka.createElement(m,{className:"_49nm",href:'#',onClick:this.handleAddCreditCardClick},ua)));},renderSelectedCard:function(){var xa=this.state.selectedCard;return (ka.createElement(ia,{className:"_21x5",size:'small',type:'primary'},ka.createElement('div',{className:"_49nn"},xa.getName()),ka.createElement('div',{className:"_21wx"},xa.getCreditCardNumberFormatted()),ka.createElement('div',{className:"_21ww"},'\u00b7'),ka.createElement(m,{className:"_21wy",onClick:this.handleChangeSelectedCardClick,href:'#'},ta)));},renderFormButtons:function(){var xa,ya=ra&&this.props.useModal?ka.createElement(q,{label:pa._("Cancel"),onClick:(function(){this._handleToggle(false);}).bind(this),type:'secondary'}):null;if(this.isRequesting()){xa=ka.createElement('div',null,ya,this.renderRequestButton());}else if(!this.state.creditCards.length){xa=ka.createElement('div',null,ya,this.renderAddCardNextButton());}else if(this.state.showChooseCreditCardForm){xa=ka.createElement('div',null,this.renderChooseCardBackButton(),this.renderChooseCardNextButton());}else xa=ka.createElement('div',null,ya,this.renderPayButton());return xa;},renderChooseCardBackButton:function(){return (ka.createElement(q,{label:pa._("Back"),onClick:this.handleBackClick,ref:'back_button',size:'medium',type:'secondary',use:'default'}));},renderAddCardNextButton:function(){return (ka.createElement(q,{disabled:this.isAddCardNextButtonDisabled(),label:pa._("Next"),onClick:this.handleAddCardNextClick,ref:'add_card_next_button',size:'medium',type:'primary',use:'default'}));},renderChooseCardNextButton:function(){return (ka.createElement(q,{label:pa._("Next"),onClick:this.handleChooseCardNextClick,ref:'choose_card_next_button',size:'medium',type:'primary',use:'confirm'}));},renderPayButton:function(){return (ka.createElement(q,{disabled:this.isSendButtonDisabled(),label:pa._("Pay"),onClick:this.handleSendClick,ref:'send_button',size:'medium',type:'primary',use:'confirm'}));},renderRequestButton:function(){return (ka.createElement(q,{disabled:this.isRequestButtonDisabled(),label:pa._("Request"),onClick:this.handleRequestClick,ref:'request_button',size:'medium',type:'primary',use:'confirm'}));},renderPaymentDetails:function(){var xa;if(this.isRequesting())return null;if(this.state.creditCards.length){if(this.state.showChooseCreditCardForm){xa=this.renderAddDebitCardLink();}else xa=this.renderSelectedCard();}else xa=ka.createElement('div',{className:"_2abl"},ka.createElement(ia,{type:'secondary',ref:'send_money_dialog_add_card_next_text'},pa._("Sending money is free and secure")));return xa;},renderFooter:function(){var xa,ya,za;if(!this.state.isCreditCardsFetchComplete){xa=ka.createElement('div',{className:"_2-vg"},ka.createElement(na,{className:"_2-vh"}));}else{ya=ka.createElement('div',{className:"_21x4"},this.renderPaymentDetails());za=ka.createElement('div',{className:"_4zf-"},this.renderFormButtons());}return (ka.createElement('div',{className:"_5p-k"},xa,ya,za));},renderMemo:function(){var xa=this.isPayingForRequest(),ya=this.props.memoText;if(!y.P2PWWWMemoField||xa&&!ya)return null;if(xa&&ya)return (ka.createElement('div',{className:"_5exl"},ka.createElement(da,{memoText:ya})));return (ka.createElement('div',{className:"_5exl"},ka.createElement(ca,{defaultValue:ya,isRequesting:this.isRequesting(),onChange:this.handleMemoChange})));},renderSendMoneyForm:function(){var xa=ra?32:40,ya=pa._("Send to");if(this.isRequesting())ya=pa._("Request to");return (ka.createElement('div',null,ka.createElement('div',{className:"_49no _2pi4",ref:'send_money_dialog_title'},ka.createElement(l,{spacing:'large'},ka.createElement(k,{className:"_5p-i",height:xa,src:this.props.receiver&&(this.props.receiver.big_image_src||this.props.receiver.image_src),width:xa}),ka.createElement('div',{className:"_3-8w"},ka.createElement(ia,{type:'secondary'},ya),ka.createElement(ia,{className:"_5p-j",size:'small',type:'primary',weight:'bold'},this.props.receiver&&this.props.receiver.name))),ka.createElement(m,{className:"_49np",href:z.helpCenterURI,target:'_blank'})),ka.createElement('div',{className:"_2abm"},this.renderMainContainer()),this.renderMemo(),ka.createElement('div',{className:"_21w-"+(ra?' '+"_4eb_":'')},this.renderFooter())));},renderMainContainer:function(){var xa;if(this.state.showChooseCreditCardForm){xa=ka.createElement('div',{className:"_xn7"},ka.createElement(s,{creditCards:this.state.creditCards,selectedCard:this.state.selectedCard,ref:'choose_credit_card_form'}));}else xa=ka.createElement('div',{className:"_2abn"},ka.createElement(ga,{currencySymbol:this.props.currencySymbol,disabled:this.isPayingForRequest(),isRequesting:this.isRequesting(),onInputChange:this.onAmountInputChange,ref:'send_money_amount_input',value:this.state.amount}));return xa;},renderActionToggleHeader:function(){var xa=this.isPaying(),ya=this.isRequesting();if(this.isPayingForRequest()||!sa)return null;return (ka.createElement('div',{className:"_4uvi"},ka.createElement(ha,{isPaying:xa,isRequesting:ya,onPayClick:(function(){if(!this.isPaying())this.setState({isPaying:true,isRequesting:false},(function(){this.focusAmountInput();this.log(ea.UI_ACTN_INITIATE_SEND);}).bind(this));}).bind(this),onRequestClick:(function(){if(!this.isRequesting())this.setState({isPaying:false,isRequesting:true},(function(){this.focusAmountInput();this.log(ea.UI_ACTN_INITIATE_REQUEST);}).bind(this));}).bind(this)})));},renderLayers:function(){var xa={},ya,za,ab=this.props.receiver&&this.props.receiver.short_name,bb;if(this.props.useModal)bb={LayerFadeOnShow:false};if(this.state.addCreditCardDialogShown){if(this.state.isAmountValid){za=pa._("Please enter a debit card to send {Amount} to {Recipient name}. Credit cards can't be used.",[pa.param('Amount',this.props.currencySymbol+this.state.amount),pa.param('Recipient name',ab)]);ya=pa._("Pay");}xa.addCreditCard=ka.createElement(p,{behaviors:bb,eventFlow:this.getEventFlow(),loggingData:this.getPlatformLoggingData(),onCancel:this.onAddCreditCardCancel,onSuccess:this.onAddCreditCardSuccess,ref:'send_money_dialog_add_credit_card_form',saveButtonText:ya,showCancelButton:!!ra,text:za});}else if(this.state.confirmAmountDialogShown){xa.confirmAmount=ka.createElement(t,{amount:this.state.amount,behaviors:bb,currencySymbol:this.props.currencySymbol,onCancel:this.onConfirmAmountCancel,onConfirm:this.onConfirmAmountSuccess,receiverName:ab});}else if(this.state.verifyCreditCardDialogShown){xa.verifyCreditCard=ka.createElement(ja,{asyncRequestState:this.state.asyncRequestState,behaviors:bb,creditCard:this.state.selectedCard,isSending:true,onCancel:this.onVerifyCreditCardCancel,onSuccess:this.onVerifyCreditCardSuccess});}else if(this.state.editCreditCardDialogShown)xa.confirmAmount=ka.createElement(x,{asyncRequestState:this.state.asyncRequestState,behaviors:bb,creditCard:this.state.selectedCard,onCancel:this.onEditCreditCardCancel,onSuccess:this.onEditCreditCardSuccess});return xa;},render:function(){var xa,ya=null,za={},ab=ra?286:260;if(this.props.useModal&&this.isDialogShowing())return null;if(this.props.useModal){xa=v;ya=ka.createElement(w,null,pa._("Confirm Payment"));za={layerHideOnBlur:false};ab=ra?350:ab;}else{xa=ra?n:ma;za={alignment:this.props.flyoutAlignment?this.props.flyoutAlignment:ra?'right':'left',context:this.props.context,position:this.props.position||'above',onBlur:this._handleBlur};}return (ka.createElement(xa,babelHelpers._extends({onToggle:this._handleToggle,shown:true,width:ab},za),ka.createElement('div',{className:"_21x9"+(ra?' '+"_1pka":'')+(sa?' '+"_4uvl":'')+(this.props.useModal?' '+"_35wt":'')},ya,this.renderActionToggleHeader(),this.renderSendMoneyForm(),ka.createElement(aa,{ref:'send_money_dialog_loader',visible:this.state.loading}))));}});f.exports=wa;},null);