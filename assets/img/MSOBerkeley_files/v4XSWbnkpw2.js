/*!CK:1363508047!*//*1450515055,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["\/aCUp"]); }

__d('P2PSendMoneyButtonImpl.react',['CurrentEnvironment','ImmutableObject','P2PAbstractSendMoneyButton.react','P2PActions','P2PErrorDialog.react','P2PGKValues','P2PGroupSendDialog.react','P2PPasswordProtectionNUXDialog.react','P2PPasswordProtectionStatusTypes','P2PSendMoneyDialog.react','P2PSendMoneyNUXContextualDialog.react','P2PSendMoneySuccessDialog.react','P2PTransferParam','P2PTransferStore','P2PTransferRiskResult','P2PUnderManualReviewDialog.react','P2PUserEligibilityStore','P2PVerificationFlowHelper','React','ReactDOM','ReactLayeredComponentMixin','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){'use strict';if(c.__markCompiled)c.__markCompiled();var ea=z.PropTypes,fa=z.createClass({displayName:'P2PSendMoneyButtonImpl',mixins:[ba],propTypes:{amount:ea.string,button:ea.object,groupThreadFBID:ea.string,flyoutAlignment:ea.string,isNewEmptyLocalThread:ea.bool,isGroupChat:ea.bool,onTrigger:ea.func,participants:ea.arrayOf(ea.object).isRequired,platformData:ea.object,sendMoneyDialogShown:ea.bool,sendMoneyNUXDismissed:ea.bool,threadID:ea.string,threadFBID:ea.string},getDefaultProps:function(){return {amount:'',groupThreadFBID:'',onTrigger:ca,sendMoneyDialogShown:false,sendMoneyNUXDismissed:false};},getInitialState:function(){return {participants:this.props.participants};},componentDidMount:function(){this.userEligibilityStoreSub=x.addListener('change',this.onUserEligibilityChange);this.setEligibilityState();},componentWillUnmount:function(){if(this.userEligibilityStoreSub){this.userEligibilityStoreSub.remove();this.userEligibilityStoreSub=null;}},componentWillReceiveProps:function(ga){if(ga.participants.length!==this.props.participants.length||ga.threadID!==this.props.threadID)this.setState({participants:ga.participants},(function(){this.setEligibilityState();}).bind(this));},setEligibilityState:function(){var ga,ha,ia=this.state.participants;if(!ia.length)return;ga=ia.map(function(ka){return ka.userID;});ha=x.getEligibilityByUserIDs(ga);for(var ja=0;ja<ia.length;ja++)ia[ja]=i.set(ia[ja],{p2p_eligible:ha[ia[ja].userID]});this.setState({participants:ia});},onUserEligibilityChange:function(){this.setEligibilityState();},canShowSendMoneyDialog:function(){if(!this.state.participants.length)return false;if(this.getRecipient()&&!this.isRecipientEligible())return false;return true;},originalCreateTransactionResponse:null,_onButtonClick:function(){this.canShowSendMoneyDialog()&&this.showSendMoneyDialog();},hideSendMoneyDialog:function(){k.chatSendViewClosed({threadID:this.props.threadID});},showSendMoneyDialog:function(){k.chatSendViewOpened({referrer:this.props.referrer,threadID:this.props.threadID});},_handleDialogToggle:function(ga){if(!ga){this.hideSendMoneyDialog();}else this.showSendMoneyDialog();},handlePaymentRequestSuccess:function(){this.hideSendMoneyDialog();this.props.onTrigger();},handleOnSendSuccess:function(ga){this.hideSendMoneyDialog();var ha=ga[t.RISK_RESULT];this.originalCreateTransactionResponse=ga;if(ha===v.REQUIRE_VERIFICATION){y.startVerificationFlow(ga.id,true,this.handleVerificationCompleted);}else if(ha===v.UNDER_MANUAL_REVIEW){this.showUnderManualReviewDialog();}else this.handlePostSendSteps();},handleVerificationCompleted:function(ga){this.handlePostSendSteps(!ga);},handlePostSendSteps:function(ga){var ha=this.originalCreateTransactionResponse,ia=ha.passwordProtection===p.NOT_SET;if(!ga&&ha.isFirstSend){this._passwordNUXPending=ia;this.showSendSuccessDialog();}else if(ia){this.showPasswordProtectionDialog();}else k.hideDialog();this.originalCreateTransactionResponse=null;this.props.onTrigger();},handleConfirmationOKClick:function(){if(this._passwordNUXPending){this._passwordNUXPending=false;this.showPasswordProtectionDialog();}else k.hideDialog();},handleSendError:function(ga){this.showErrorDialog(ga);},handlePaymentRequestError:function(ga){this.showPaymentRequestErrorDialog(ga);},getMoneyButtonNode:function(){return aa.findDOMNode(this.refs.p2pSendMoneyButton);},getRecipient:function(){if(!this.props.isGroupChat){return this.state.participants[0];}else return this.getGroupSendRecipient();},getGroupSendRecipient:function(){return this.state.participants.filter((function(ga){return ga.userID===this.props.groupSendRecipientUserID;}).bind(this))[0];},isRecipientEligible:function(){var ga=this.getRecipient();if(!ga)return false;return !!(ga.p2p_eligible||u.hasReceivedFromSender(ga.userID));},showErrorDialog:function(ga){var ha=da._("Problem Sending Money");k.showDialog(l,{error:ga,onOKClick:k.hideDialog,title:ha});},showPaymentRequestErrorDialog:function(ga){var ha=da._("Problem Requesting Money");k.showDialog(l,{error:ga,onOKClick:k.hideDialog,title:ha});},showPasswordProtectionDialog:function(){k.showDialog(o,{onComplete:k.hideDialog});},showSendSuccessDialog:function(){k.showDialog(s,{onClose:this.handleConfirmationOKClick});},showUnderManualReviewDialog:function(){k.showDialog(w,{onClose:this.handlePostSendSteps});},shouldShowNUX:function(){return (!this.state.sendMoneyNUXDismissed&&!m.P2PUserAddedCredentialBefore&&!u.hasSentDuringSession());},renderLayers:function(){var ga={},ha='USD',ia='$',ja=this.getRecipient();if(this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown)if(this.shouldShowNUX()){ga.nux=z.createElement(r,{context:this.getMoneyButtonNode(),loggingData:{object_id:ja&&ja.userID},flyoutAlignment:this.props.flyoutAlignment,onNextClick:(function(){return this.setState({sendMoneyNUXDismissed:true});}).bind(this),onToggle:this._handleDialogToggle});}else if(!this.props.groupSendRecipientUserID&&this.props.isGroupChat&&this.props.threadFBID){ga.groupSendMoneyDialog=z.createElement(n,{amount:this.props.amount,context:this.getMoneyButtonNode(),flyoutAlignment:this.props.flyoutAlignment,currency:ha,onToggle:this._handleDialogToggle,participants:this.state.participants,referrer:this.props.referrer,threadID:this.props.threadID,threadFBID:this.props.threadFBID});}else ga.sendMoneyDialog=z.createElement(q,{amount:this.props.amount,context:this.getMoneyButtonNode(),currency:ha,currencySymbol:ia,groupThreadFBID:this.props.groupThreadFBID,flyoutAlignment:this.props.flyoutAlignment,memoText:this.props.memoText,onToggle:this._handleDialogToggle,onError:this.handleSendError,onPaymentRequestError:this.handlePaymentRequestError,onPaymentRequestSuccess:this.handlePaymentRequestSuccess,onSendSuccess:this.handleOnSendSuccess,platformData:this.props.platformData,receiver:ja,ref:'send_money_dialog',referrer:this.props.referrer,paymentRequestID:this.props.paymentRequestID,useModal:this.props.useModal});return ga;},render:function(){var ga=this.getRecipient();if(this.props.isNewEmptyLocalThread&&this.state.participants.length>1)return null;return (z.createElement(j,{button:this.props.button,className:this.props.className,isActive:this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown,isDisabled:!!(ga&&!this.isRecipientEligible()),isMessenger:!!h.messengerdotcom,onClick:this._onButtonClick,recipientName:ga&&ga.short_name,ref:'p2pSendMoneyButton'}));}});f.exports=fa;},null);